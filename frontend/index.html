<!DOCTYPE html>
<html>
<head>
    <title>PAYGUARD AI</title>
    <style>
        body {
            font-family: Arial;
            max-width: 500px;
            margin: auto;
            padding-top: 40px;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
        }
        .high { color: red; }
        .medium { color: orange; }
        .low { color: green; }
        .high-bg {
            background-color: #ffe6e6;
            border: 1px solid red;
        }
        .medium-bg {
            background-color: #fff4e5;
            border: 1px solid orange;
        }
        .low-bg {
            background-color: #e6ffed;
            border: 1px solid green;
        }
    </style>
</head>

<body>

<h2>PAYGUARD AI</h2>
<p>Check payment safety before approving</p>

<input id="upi" type="text" placeholder="Enter UPI ID (e.g., name@bank)">
<input id="amount" type="number" placeholder="Enter Amount">

<select id="payee">
    <option value="known">Known Payee</option>
    <option value="new">New Payee</option>
</select>

<select id="time">
    <option value="day">Day</option>
    <option value="night">Night</option>
</select>

<select id="urgent">
    <option value="0">No Urgency</option>
    <option value="1">Urgency / Pressure</option>
</select>

<button onclick="checkRisk()">Check Safety</button>

<div id="result" style="display:none; margin-top:20px; padding:15px; border-radius:8px;">
    <h3 id="riskText"></h3>

    <div style="background:#eee; border-radius:10px; overflow:hidden;">
        <div id="riskBar" style="height:15px; width:0%;"></div>
    </div>

    <p><strong>Risk Score:</strong> <span id="riskScore"></span>/100</p>

    <h4>Why this warning?</h4>
    <ul id="reasons"></ul>

    <h4>Recommended Action</h4>
    <p id="advice"></p>
</div>

<script>
// Behavioral tracking variables
let startTime = Date.now();
let pasted_upi = false;
let switchCount = 0;
let hesitation = 0;

// Detect paste on UPI field
document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("upi").addEventListener("paste", () => { pasted_upi = true; });
});

// Detect page switching (tab changes)
document.addEventListener("visibilitychange", () => {
    if (!document.hidden) switchCount++;
});

// Detect hesitation (backspaces)
document.addEventListener("keydown", (e) => {
    if (e.key === "Backspace") hesitation++;
});

// Calculate input time in seconds
function getInputTime() {
    return Math.round((Date.now() - startTime) / 1000);
}

async function checkRisk() {
    const amount = Number(document.getElementById("amount").value);
    const payeeType = document.getElementById("payee").value;
    const timeOfDay = document.getElementById("time").value;
    const urgency = Number(document.getElementById("urgent").value);

    const response = await fetch("http://127.0.0.1:8000/check-transaction", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            amount: amount,
            payee_type: payeeType,
            time_of_day: timeOfDay,
            urgency: urgency,

            // Behavioral signals
            input_time: getInputTime(),
            pasted_upi: pasted_upi,
            switch_count: switchCount,
            hesitation_score: hesitation
        })
    });

    const data = await response.json();

    const resultBox = document.getElementById("result");
    const riskText = document.getElementById("riskText");
    const riskBar = document.getElementById("riskBar");
    const riskScore = document.getElementById("riskScore");
    const reasonsEl = document.getElementById("reasons");
    const adviceEl = document.getElementById("advice");

    resultBox.style.display = "block";
    resultBox.className = "";

    riskText.innerText = "Risk Level: " + data.risk_level;
    riskScore.innerText = data.risk_score;
    riskBar.style.width = data.risk_score + "%";

    reasonsEl.innerHTML = "";
    data.reasons.forEach(r => {
        const li = document.createElement("li");
        li.innerText = r;
        reasonsEl.appendChild(li);
    });

    if (data.risk_level === "HIGH") {
        resultBox.classList.add("high-bg");
        riskBar.style.background = "red";
        adviceEl.innerText = "Do NOT proceed. Verify the request directly with the sender.";
    } 
    else if (data.risk_level === "MEDIUM") {
        resultBox.classList.add("medium-bg");
        riskBar.style.background = "orange";
        adviceEl.innerText = "Proceed only after double-checking the payment details.";
    } 
    else {
        resultBox.classList.add("low-bg");
        riskBar.style.background = "green";
        adviceEl.innerText = "Safe to proceed. No major scam indicators detected.";
    }
}
</script>

</body>
</html>
